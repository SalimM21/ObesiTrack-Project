<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Pr√©diction</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { padding: 8px; width: 200px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #1976D2; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1259a7; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <h1>üß™ Test Simple de Pr√©diction</h1>
    
    <div id="auth-status" style="margin-bottom: 20px; padding: 10px; background: #fff3cd; border-radius: 5px;">
        <strong>Statut d'authentification :</strong> <span id="auth-text">V√©rification...</span>
    </div>

    <form id="prediction-form">
        <div class="form-group">
            <label for="age">√Çge :</label>
            <input type="number" id="age" name="age" value="25" required>
        </div>

        <div class="form-group">
            <label for="gender">Genre :</label>
            <select id="gender" name="gender" required>
                <option value="Male">Homme</option>
                <option value="Female">Femme</option>
            </select>
        </div>

        <div class="form-group">
            <label for="height">Taille (m) :</label>
            <input type="number" id="height" name="height" step="0.01" value="1.75" required>
        </div>

        <div class="form-group">
            <label for="weight">Poids (kg) :</label>
            <input type="number" id="weight" name="weight" step="0.1" value="70" required>
        </div>

        <div class="form-group">
            <label for="family_history_with_overweight">Ant√©c√©dents familiaux :</label>
            <select id="family_history_with_overweight" name="family_history_with_overweight" required>
                <option value="no">Non</option>
                <option value="yes">Oui</option>
            </select>
        </div>

        <div class="form-group">
            <label for="favc">Aliments caloriques fr√©quents :</label>
            <select id="favc" name="favc" required>
                <option value="no">Non</option>
                <option value="yes">Oui</option>
            </select>
        </div>

        <div class="form-group">
            <label for="fcvc">Fr√©quence l√©gumes (1-3) :</label>
            <input type="number" id="fcvc" name="fcvc" step="0.1" min="1" max="3" value="2.5" required>
        </div>

        <div class="form-group">
            <label for="ncp">Nombre de repas (1-8) :</label>
            <input type="number" id="ncp" name="ncp" min="1" max="8" value="3" required>
        </div>

        <div class="form-group">
            <label for="caec">Aliments entre repas :</label>
            <select id="caec" name="caec" required>
                <option value="no">Jamais</option>
                <option value="sometimes">Parfois</option>
                <option value="frequently">Souvent</option>
                <option value="always">Toujours</option>
            </select>
        </div>

        <div class="form-group">
            <label for="smoke">Fumez-vous ?</label>
            <select id="smoke" name="smoke" required>
                <option value="no">Non</option>
                <option value="yes">Oui</option>
            </select>
        </div>

        <div class="form-group">
            <label for="ch2o">Consommation d'eau (0-10) :</label>
            <input type="number" id="ch2o" name="ch2o" step="0.1" min="0" max="10" value="2.5" required>
        </div>

        <div class="form-group">
            <label for="scc">Surveillance calories :</label>
            <select id="scc" name="scc" required>
                <option value="no">Non</option>
                <option value="yes">Oui</option>
            </select>
        </div>

        <div class="form-group">
            <label for="faf">Activit√© physique (0-7) :</label>
            <input type="number" id="faf" name="faf" step="0.1" min="0" max="7" value="1.5" required>
        </div>

        <div class="form-group">
            <label for="tue">Temps √©crans (0-24h) :</label>
            <input type="number" id="tue" name="tue" step="0.1" min="0" max="24" value="2.5" required>
        </div>

        <div class="form-group">
            <label for="cal">Consommation alcool (0-3) :</label>
            <input type="number" id="cal" name="cal" min="0" max="3" value="0" required>
        </div>

        <div class="form-group">
            <label for="mtrans">Transport :</label>
            <select id="mtrans" name="mtrans" required>
                <option value="Public_Transportation">Transport public</option>
                <option value="Automobile">Voiture</option>
                <option value="Walking">Marche</option>
                <option value="Bike">V√©lo</option>
                <option value="Motorbike">Moto</option>
            </select>
        </div>

        <button type="submit" id="submit-btn">üîÆ Faire une pr√©diction</button>
    </form>

    <div id="result" class="result" style="display: none;"></div>

    <div style="margin-top: 30px;">
        <h3>Actions :</h3>
        <button onclick="window.location.href='index.html'">üîê Se connecter</button>
        <button onclick="window.location.href='register.html'">üìù S'inscrire</button>
        <button onclick="testConnection()">üîó Tester connexion API</button>
        <button onclick="clearToken()">üö™ Se d√©connecter</button>
    </div>

    <script src="js/app.js"></script>
    <script>
        // V√©rifier l'authentification au chargement
        window.addEventListener('load', () => {
            checkAuthStatus();
        });

        function checkAuthStatus() {
            const token = getToken();
            const authText = document.getElementById('auth-text');
            const authStatus = document.getElementById('auth-status');
            
            if (token) {
                authText.textContent = '‚úÖ Connect√©';
                authStatus.style.background = '#d4edda';
                authStatus.style.color = '#155724';
            } else {
                authText.textContent = '‚ùå Non connect√©';
                authStatus.style.background = '#f8d7da';
                authStatus.style.color = '#721c24';
            }
        }

        async function testConnection() {
            try {
                const response = await fetch('http://localhost:8001/');
                const data = await response.json();
                alert('‚úÖ API connect√©e: ' + data.message);
            } catch (error) {
                alert('‚ùå Erreur API: ' + error.message);
            }
        }

        document.getElementById('prediction-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const token = getToken();
            if (!token) {
                alert('‚ùå Vous devez √™tre connect√© pour faire une pr√©diction !');
                return;
            }

            const formData = new FormData(e.target);
            const predictionData = {
                age: parseInt(formData.get('age')),
                gender: formData.get('gender'),
                height: parseFloat(formData.get('height')),
                weight: parseFloat(formData.get('weight')),
                family_history_with_overweight: formData.get('family_history_with_overweight'),
                favc: formData.get('favc'),
                fcvc: parseFloat(formData.get('fcvc')),
                ncp: parseInt(formData.get('ncp')),
                caec: formData.get('caec'),
                smoke: formData.get('smoke'),
                ch2o: parseFloat(formData.get('ch2o')),
                scc: formData.get('scc'),
                faf: parseFloat(formData.get('faf')),
                tue: parseFloat(formData.get('tue')),
                cal: parseInt(formData.get('cal')),
                mtrans: formData.get('mtrans')
            };

            const resultDiv = document.getElementById('result');
            const submitBtn = document.getElementById('submit-btn');
            
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Envoi...';
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ Envoi de la pr√©diction...';

            try {
                console.log('Donn√©es envoy√©es:', predictionData);
                const result = await sendPrediction(predictionData);
                console.log('R√©sultat re√ßu:', result);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Pr√©diction r√©ussie !</h3>
                    <p><strong>R√©sultat :</strong> ${result.result}</p>
                    <p><strong>Probabilit√©s :</strong></p>
                    <ul>
                        ${Object.entries(result.probability).map(([key, value]) => 
                            `<li>${key}: ${(value * 100).toFixed(1)}%</li>`
                        ).join('')}
                    </ul>
                `;
            } catch (error) {
                console.error('Erreur:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Erreur de pr√©diction</h3>
                    <p>${error.message}</p>
                `;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üîÆ Faire une pr√©diction';
            }
        });
    </script>
</body>
</html>
